<!DOCTYPE html>
<html>
<head>
	<title>Achewood! ...mobile!</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.3.2.css">
	<script src="js/jquery-2.0.3.js" ></script>
	<script src="js/jquery.mobile-1.3.2.js" ></script>
	<script src="js/plugins/cross-domain-ajax/jquery.xdomainajax.js"></script>
	<script language="JavaScript">
		const ACHEWOOD_BASE_URL = 'http://www.achewood.com';
		var $prevComicLink;
		var $nextComicLink;
		var $comicTarget;

		var loadAchewood = function (event) { 
			var url;
			var loadUrl = ACHEWOOD_BASE_URL;

			//if the parameter is passed, use it to load the correct comic url
			if (event && event.data) { url = event.data.urlParam; }
			if (url) { loadUrl = ACHEWOOD_BASE_URL + '/' + url; }
			$.get(loadUrl, parseAchewood );
		}

		var parseAchewood = function( achewoodIndex ) {
            //cross platform xml object creation from w3schools
            try { //Internet Explorer
              xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
              xmlDoc.async="false";
              xmlDoc.loadXML(achewoodIndex.responseText);
            }
            catch(e) {
              try { // Firefox, Mozilla, Opera, etc.
                parser = new DOMParser();
                xmlDoc = parser.parseFromString(achewoodIndex.responseText,"text/xml");
			  }
              catch(e) {
                alert(e.message);
                return;
	          }
            }

            getComic(xmlDoc.getElementsByTagName("body")[0].innerHTML);

            // console.log(xmlDoc.getElementsByTagName("body")[0].innerHTML); //[0].childNodes[0].nodeValue));
        }

		var getComic = function( content ) {

			$comicTarget = $("img#comicTarget");
			$prevComicLink = $("a#comicPrev");
			$nextComicLink = $("a#comicNext");

			var $comic = $("img.comic", $(content));
			
			$comicTarget.attr({
				src: ACHEWOOD_BASE_URL + $comic.attr("src") //,
				// title: $comic.attr("title")		
			});
			$("div#comicAlt").html($comic.attr("title"));
			
			$prevComicLink.unbind('click');
			$prevComicLink.click({urlParam: $( "a.dateNav[title=\"Previous comic\"]", $(content)).attr("href") }, loadAchewood);

			var nextUrl = $("a.dateNav[title=\"Next comic\"]", $(content)).attr("href");
			$nextComicLink.unbind('click');
			if (nextUrl) { 
				$nextComicLink.click({urlParam: nextUrl}, loadAchewood);
			}
		}
		$( document ).ready( loadAchewood() );
	</script>

</head>
<body data-role="page">
	<div data-role="header">
		<h1>Achewood ...mobile!</h1>
		<a data-role="button" data-iconpos="left" data-icon="arrow-l" data-inline="true" id="comicPrev" href="#">Prev</a>
		<a data-role="button" data-iconpos="right" data-icon="arrow-r" data-inline="true" id="comicNext" href="#">Next</a>
		<a data-role="button" data-iconpos="notext" data-icon="info" data-inline="true" id="comicAltLink" href="#">i</a>
	</div>
	<div data-role="content">
		<img id="comicTarget" src="img/hyperbole.png" />
		<div id="comicAlt">&nbsp;</div>
	</div>
	<ul data-role="footer">
		<li ><a href="http://achewood.myshopify.com/" target="_blank" id="shopLink">Support Achewood, Buy Something</a></li>
	</ul>
</body>

</html>